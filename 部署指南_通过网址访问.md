# 部署指南：通过网址直接访问前端

本指南说明如何将前端构建为静态文件，并通过Django直接提供前端服务，使对方无需运行前端开发服务器，仅通过网址即可访问。

## 📋 前置要求

1. **已完成开发服务器配置**
   - Django后端已配置并可运行
   - 信令服务器（Socket.IO）已配置并可运行
   - 前端代码已开发完成

2. **环境要求**
   - Node.js 和 npm 已安装
   - Python 和 Django 已安装
   - 所有依赖已安装

---

## 🚀 部署步骤

### 步骤1：构建前端为静态文件

在项目根目录下，进入前端目录并构建：

```bash
cd SignTalk_System/signtalk_web/signtalk/fronted
npm run build
```

构建完成后，静态文件将输出到 `SignTalk_System/signtalk_web/signtalk/static/` 目录。

**注意**：如果 `static` 目录不存在，构建过程会自动创建。

### 步骤2：启动Django服务器

构建完成后，启动Django服务器：

```bash
cd SignTalk_System/signtalk_web/signtalk
python manage.py runserver 0.0.0.0:8000
```

**重要**：使用 `0.0.0.0:8000` 而不是 `127.0.0.1:8000`，这样可以让局域网内的其他设备访问。

### 步骤3：启动信令服务器

在另一个终端窗口中，启动信令服务器（Socket.IO）：

```bash
cd SignTalk_System/signtalk_web/signtalk/fronted/server
node main.js
```

信令服务器默认运行在 `3333` 端口。

### 步骤4：访问应用

现在，任何能访问你服务器IP地址的设备都可以通过以下网址访问：

```
http://你的服务器IP:8000
```

例如：
- 如果服务器IP是 `172.20.10.5`，访问地址为：`http://172.20.10.5:8000`
- 如果服务器IP是 `192.168.1.100`，访问地址为：`http://192.168.1.100:8000`

**注意**：
- 前端会自动检测当前访问的主机名和端口，并自动配置API地址
- 信令服务器地址需要配置，见下方说明

---

## ⚙️ 配置说明

### 1. 配置信令服务器地址（如果需要）

如果信令服务器运行在不同的主机上，或者需要自定义端口，可以在构建前设置环境变量：

**方式A：在构建时设置**

在 `fronted/.env.production` 文件中添加（如果不存在则创建）：

```env
VITE_SIGNAL_HOST=你的服务器IP
VITE_SIGNAL_PORT=3333
```

然后重新构建：

```bash
npm run build
```

**方式B：运行时配置**

前端会自动使用 `window.location.hostname` 作为信令服务器主机，因此如果信令服务器和Django运行在同一台机器上，无需额外配置。

### 2. 配置Django的ALLOWED_HOSTS

确保 `settings.py` 中的 `ALLOWED_HOSTS` 包含你的服务器IP：

```python
ALLOWED_HOSTS = ["127.0.0.1", "localhost", "你的服务器IP"]
```

例如：

```python
ALLOWED_HOSTS = ["127.0.0.1", "localhost", "172.20.10.5"]
```

### 3. 配置CORS（如果需要）

如果对方从不同的域名访问，确保 `settings.py` 中配置了CORS：

```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:8000",
    "http://127.0.0.1:8000",
    "http://你的服务器IP:8000",
]

CSRF_TRUSTED_ORIGINS = [
    "http://localhost:8000",
    "http://127.0.0.1:8000",
    "http://你的服务器IP:8000",
]
```

---

## 🔍 如何查询服务器IP地址

### Windows

打开PowerShell或命令提示符，运行：

```powershell
ipconfig
```

查找 "IPv4 地址"，例如：`172.20.10.5`

### Linux/Mac

在终端运行：

```bash
ifconfig
# 或
ip addr
```

查找你的网络接口（通常是 `eth0` 或 `wlan0`）的IP地址。

---

## 📝 快速部署检查清单

在部署前，请确认：

- [ ] 前端已构建（`npm run build`）
- [ ] `static` 目录存在且包含构建后的文件
- [ ] Django的 `ALLOWED_HOSTS` 包含服务器IP
- [ ] Django服务器使用 `0.0.0.0:8000` 启动
- [ ] 信令服务器已启动（端口3333）
- [ ] 防火墙允许8000和3333端口

---

## 🐛 故障排查

### 问题1：访问时显示空白页面

**可能原因**：
- 前端未构建
- 静态文件路径配置错误

**解决方法**：
1. 确认已运行 `npm run build`
2. 检查 `static` 目录是否存在 `index.html`
3. 检查浏览器控制台是否有错误信息

### 问题2：API请求失败

**可能原因**：
- API地址配置错误
- CORS配置问题

**解决方法**：
1. 打开浏览器开发者工具，查看网络请求
2. 确认API请求的地址是否正确
3. 检查Django控制台是否有CORS错误
4. 确认 `settings.py` 中的CORS配置

### 问题3：视频通话无法连接

**可能原因**：
- 信令服务器未启动
- 信令服务器地址配置错误
- 防火墙阻止了3333端口

**解决方法**：
1. 确认信令服务器已启动
2. 打开浏览器控制台，查看Socket.IO连接错误
3. 确认信令服务器地址配置正确
4. 检查防火墙设置

### 问题4：对方无法访问

**可能原因**：
- 服务器IP地址错误
- 防火墙阻止访问
- Django未监听所有网络接口

**解决方法**：
1. 确认使用 `0.0.0.0:8000` 启动Django
2. 确认对方的设备与服务器在同一局域网
3. 检查防火墙是否允许8000端口
4. 尝试在服务器本地访问 `http://127.0.0.1:8000` 确认服务器正常运行

---

## 🔄 更新前端代码后的重新部署

如果修改了前端代码，需要重新构建：

```bash
cd SignTalk_System/signtalk_web/signtalk/fronted
npm run build
```

构建完成后，重启Django服务器即可，无需重启信令服务器。

---

## 📚 相关文件

- **前端构建配置**：`fronted/vite.config.js`
- **API配置**：`fronted/src/config/api.js`
- **Django URL配置**：`signtalk/urls.py`
- **Django视图**：`signtalk/views.py`
- **Django设置**：`signtalk/settings.py`

---

## 💡 提示

1. **开发环境 vs 生产环境**
   - 开发时：前端运行在Vite开发服务器（5173端口），Django运行在8000端口
   - 部署后：前端通过Django提供（8000端口），无需Vite开发服务器

2. **性能优化**
   - 构建后的静态文件已经过优化和压缩
   - 生产环境建议配置Nginx等反向代理服务器

3. **安全建议**
   - 生产环境建议使用HTTPS
   - 配置适当的防火墙规则
   - 定期更新依赖包

---

## ✅ 验证部署成功

部署成功后，你应该能够：

1. 在任何设备上通过 `http://服务器IP:8000` 访问应用
2. 看到完整的应用界面（不是空白页面）
3. 能够登录和注册
4. 能够进行视频通话
5. 能够使用手语识别功能

如果以上功能都正常，说明部署成功！

DD：
